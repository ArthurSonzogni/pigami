name: pigami
version: '1.0'
summary: A rolling block adventure.
description: |
  The principle, roll your cube (rather rectangular) to reach the finish without falling!
  Buttons, Traps and other objects are there to make the game more challenging.
  For the more experienced, the game has a level generator. The algorithm used will put your intelligence to the test.

icon: ./resources/favicon.png
grade: stable
confinement: strict
base: core18
apps:
  pigami:
    command: desktop-launch ${SNAP}/bin/pigami
    plugs:
      - audio-playback
      - opengl
      - x11
parts:
  # Build cmake from source to get a recent version.
  cmake:
    source: https://github.com/Kitware/CMake
    source-type: git
    source-depth: 1
    plugin: cmake
    override-build: |
      mkdir -p build
      cd build
      cmake \
        -DCMAKE_INSTALL_PREFIX=$SNAPCRAFT_STAGE/cmake \
        $SNAPCRAFT_PART_SRC
      make -j ${SNAPCRAFT_PARALLEL_BUILD_COUNT}
      make install
    build-packages:
      - build-essential
      - libssl-dev
      - libncurses5-dev
    stage-packages:
      - libssl1.1
      - libncurses5
      - libtinfo5
    prime: []

  desktop-glib-only:
    plugin: make	   
    source: https://github.com/ubuntu/snapcraft-desktop-helpers.git	   
    source-subdir: glib-only	   
    build-packages:	   
    - libglib2.0-dev	   
    stage-packages:	   
    - libglib2.0-bin

  pigami:
    after: [cmake, desktop-glib-only]
    plugin: cmake
    source: https://github.com/ArthurSonzogni/pigami
    source-type: git
    source-depth: 1
    stage-packages:
      - libpulse0
      - libgl1-mesa-glx
    build-packages:
      - libglu-dev
      - libpulse-dev
      - xorg-dev
    override-build: |
      $SNAPCRAFT_STAGE/cmake/bin/cmake \
        -DCMAKE_INSTALL_PREFIX=$SNAPCRAFT_PART_INSTALL \
        -DCMAKE_BUILD_TYPE=RelWithDebInfo \
        $SNAPCRAFT_PART_SRC
      make -j ${SNAPCRAFT_PARALLEL_BUILD_COUNT}
      make install

passthrough:
  title: pigami
  license: MIT
